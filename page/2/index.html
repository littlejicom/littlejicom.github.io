<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>第 2 页 | littleji</title>
  <meta name="author" content="littleji">
  
  <meta name="description" content="littleji&#39;s blog">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="littleji">

  
    <meta property="og:image" content="undefined">
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="littleji" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-77530561-1', 'auto');
	ga('send', 'pageview');

</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-127734909-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-127734909-1');
</script>


</head>
</html>

<body>
  <header id="header" class="inner"><div class="alignleft">
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet">
  <h1><a href="/">littleji</a></h1>
  <h2><a href="/">a blog</a></h2>
  <h2><a href="https://github.com/littleji" title="GithubID:littleji" target="_blank"><i class="fa fa-3x fa-github"></i></a> &nbsp;</h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
      <li><a href="/about">About</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2018-09-06T16:00:00.000Z"><a href="/2018/09/07/20180907GettingStartedWithI3WindowManager/">2018-09-07</a></time>
      
      
  
    <h1 class="title"><a href="/2018/09/07/20180907GettingStartedWithI3WindowManager/">在Linux上使用 i3 作为窗口管理器的入门教程</a></h1>
  

    </header>
    <div class="entry">
      
        <p>注：本文首发于linux中国<br>本篇文章会介绍如何在Fedora系统中，安装、配置、使用i3桌面管理器。</p>
<p><img src="https://opensource.com/sites/default/files/styles/image-full-size/public/lead-images/windows-tiling-windows-wall.png?itok=mTH7uVrn" alt=""></p>
<p>在我的文章<a href="https://opensource.com/article/18/8/i3-tiling-window-manager" target="_blank" rel="noopener">i3 桌面让Linux更好的5个理由</a>，我分享了选择 <a href="https://i3wm.org" target="_blank" rel="noopener">i3 桌面管理器</a> 作为一种Linux桌面替代方案的最主要五个理由。<br>在本篇文章中，我将向大家展示，如何在 Fedora 28 上安装与配置 i3。</p>
<h3 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h3><p>首先进入 Fedora 系统中，打开一个终端。使用 <code>dnf</code> 来安装需要的软件包，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[ricardo@f28i3 ~]$ sudo dnf install -y i3 i3-ipc i3status i3lock dmenu terminator --exclude=rxvt-unicode</span><br><span class="line">Last metadata expiration check: 1:36:15 ago on Wed 08 Aug 2018 12:04:31 PM EDT.</span><br><span class="line">Dependencies resolved.</span><br><span class="line">================================================================================================</span><br><span class="line"> Package                     Arch         Version                           Repository     Size</span><br><span class="line">================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> dmenu                       x86_64       4.8-1.fc28                        fedora         33 k</span><br><span class="line"> i3                          x86_64       4.15-1.fc28                       fedora        323 k</span><br><span class="line"> i3-ipc                      noarch       0.1.4-12.fc28                     fedora         14 k</span><br><span class="line"> i3lock                      x86_64       2.9.1-2.fc28                      fedora         33 k</span><br><span class="line"> i3status                    x86_64       2.12-1.fc28                       updates        62 k</span><br><span class="line"> terminator                  noarch       1.91-4.fc28                       fedora        570 k</span><br><span class="line">Installing dependencies:</span><br><span class="line"> dzen2                       x86_64       0.8.5-21.20100104svn.fc28         fedora         60 k</span><br><span class="line"></span><br><span class="line">... Skipping dependencies/install messages</span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">[ricardo@f28i3 ~]$</span><br></pre></td></tr></table></figure></p>
<p>注意：在这个命令中，我排除了 <code>rxvt-unicode</code> 这个包，因为我更喜欢 <code>terminator</code> 作为我的终端模拟器。</p>
<p>据用户目前的系统状态，在命令执行过程中可能会安装很多依赖。等待所有的依赖安装完成，之后重启你的电脑。</p>
<h3 id="2-登录与初始化"><a href="#2-登录与初始化" class="headerlink" title="2. 登录与初始化"></a>2. 登录与初始化</h3><p>在你的机器重启之后，你便可以第一次体验 i3 了。在 GNOME Display Manager （GDM），选择你的用户名，之后先别着急输密码，点击下方的密码输入框下方的小齿轮，之后选择 i3 ，像下方这样：</p>
<p><img src="https://opensource.com/sites/default/files/uploads/i3_first_login_small.png" alt=""></p>
<p>输入你的密码，并点击 <code>Sign In</code>。在你第一次登入之后，会先看到 i3 的配置界面：</p>
<p><img src="https://opensource.com/sites/default/files/uploads/i3_first_configuration_small.png" alt=""></p>
<p>点击 <code>ENTER</code> 就会在 <code>$HOME/.config/i3</code> 生成一个配置文件，之后你可以通过这个配置文件来定制化 i3’s 的一些行为。</p>
<p>在下一屏，你需要选择你的 <code>Mod</code> 键。这一步很关键，因为 <code>Mod</code> 键通常都会作为 i3’s 命令快捷键的发起键。按 <code>ENTER</code> 会选择 <code>Win</code> 键作为默认的 <code>Mod</code> 键。如果你的键盘没有 <code>Win</code> 键，用 <code>Alt</code> 键做替代，用方向键键选择后按 <code>ENTER</code> 确认。</p>
<p><img src="https://opensource.com/sites/default/files/uploads/i3_generate_config_small.png" alt=""></p>
<p>现在你就登录到了 i3 的系统中。由于 i3 是一个最小化的窗口管理器，你会看到一个黑屏窗口，以及屏幕底端显式的状态栏：</p>
<p><img src="https://opensource.com/sites/default/files/uploads/i3_start_small.png" alt=""></p>
<p>接下来，让我们看看 i3 的如何实际使用。</p>
<h3 id="3-基本的快捷键"><a href="#3-基本的快捷键" class="headerlink" title="3. 基本的快捷键"></a>3. 基本的快捷键</h3><p>现在你已经登录到了 i3 的会话中，你需要几个基本的快捷键来应对基本的操作。</p>
<p>大多数的 i3 快捷键都会用到之前配置的 <code>Mod</code> 键。在下面的例子中，当我提到 <code>Mod</code> 键，请根据情况使用你定义的做替换。通常使用 <code>Win</code> 键或者 <code>Alt</code> 键。</p>
<p>首先，打开一个终端，使用 <code>Mod+ENTER</code>。重复打开几个终端，观察 i3 是如何自动将它们在桌面中排列。默认情况下， i3 会在水平的方向分割屏幕；使用 <code>Mod + v</code> 来垂直分割，再按 <code>Mod + h</code> 会恢复水平分割模式。</p>
<p><img src="https://opensource.com/sites/default/files/uploads/i3_3terminal_tiled_small.png" alt=""></p>
<p>当需要启动其他的应用，按 <code>Mod + d</code> 来打开 <code>dmenu</code>，一个简单的文字应用菜单。默认情况下，<code>dmenu</code> 会呈现出所有在你 <code>$PATH</code> 中设置的应用。使用方向键来选择你想启动的应用，同时你可以键入应用的名称，来缩小选择的范围，之后按 <code>ENTER</code> 来启动选择的应用。</p>
<p><img src="https://opensource.com/sites/default/files/uploads/i3_dmenu.png" alt=""></p>
<p>如果你的应用没有提供退出的方法，你可以使用 i3 来关闭对应的窗口，通过按 <code>Mod + Shift +q</code>。注意，你可能会丢失未保存的工作内容。</p>
<p>最后，当你想关闭会话并退出 i3，按 <code>Mod + Shift +e</code>。之后会在窗口的上方提示你是否退出。点击 <code>Yes, exit i3</code> 退出，或选择 <code>X</code> 来取消。</p>
<p><img src="https://opensource.com/sites/default/files/uploads/i3_exit_small.png" alt=""></p>
<p>这些就是 i3 中最基本的快捷键，如果想了解更多，请查阅官方文档 <a href="https://i3wm.org/docs/userguide.html#_default_keybindings" target="_blank" rel="noopener">documentation</a>。</p>
<h3 id="4-替换GDM"><a href="#4-替换GDM" class="headerlink" title="4. 替换GDM"></a>4. 替换GDM</h3><p>使用 i3 window manager 会降低你操作系统的内存占用；然而，Fedora 依然会使用 GDM 作为登录的窗口。GDM 会载入几个与 GNOME 相关的库从而占用内存。</p>
<p>如果你想进一步的降低你的内存占用，你可以使用一些更轻量级的窗口管理器来替换 GDM，比如 <code>lightdm</code>：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[ricardo@f28i3 ~]$ sudo dnf install -y lightdm</span><br><span class="line">[ricardo@f28i3 ~]$ sudo systemctl disable gdm</span><br><span class="line">Removed /etc/systemd/system/display-manager.service.</span><br><span class="line">[ricardo@f28i3 ~]$ sudo systemctl enable lightdm</span><br><span class="line">Created symlink /etc/systemd/system/display-manager.service -&gt; /usr/lib/systemd/system/lightdm.service.</span><br><span class="line">[ricardo@f28i3 ~]$</span><br></pre></td></tr></table></figure></p>
<p>之后重启你的机器来使用 Lightdm 的登录界面。</p>
<p>现在你可以继续登录并使用 i3了。</p>
<p><img src="https://opensource.com/sites/default/files/uploads/i3_lightdm_small.png" alt=""></p>
<hr>
<p>via: <a href="https://opensource.com/article/18/8/getting-started-i3-window-manager" target="_blank" rel="noopener">https://opensource.com/article/18/8/getting-started-i3-window-manager</a></p>
<p>作者：<a href="https://opensource.com/users/rgerardi" target="_blank" rel="noopener">Ricardo Gerardi</a><br>选题：<a href="https://github.com/lujun9972" target="_blank" rel="noopener">lujun9972</a><br>译者：<a href="https://github.com/littleji" target="_blank" rel="noopener">littleji</a><br>校对：<a href="https://github.com/校对者ID" target="_blank" rel="noopener">校对者ID</a></p>
<p>本文由 <a href="https://github.com/LCTT/TranslateProject" target="_blank" rel="noopener">LCTT</a> 原创编译，<a href="https://linux.cn/" target="_blank" rel="noopener">Linux中国</a> 荣誉推出</p>
<hr>
<p>版权声明:本文由littleji.com创作并发表,转载请注明作者及出处,欢迎关注公众号:littleji_com<br><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">本文遵守CC BY0SA 4.0</a><br>if you have any questions, please leave a message behind or give an <a href="https://github.com/littleji/littleji.github.io/issues" target="_blank" rel="noopener">issue</a></p>
<p>本文链接为：<a href="http://littleji.com/2018/09/07/20180907GettingStartedWithI3WindowManager/">http://littleji.com/2018/09/07/20180907GettingStartedWithI3WindowManager/</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2018-02-03T16:00:00.000Z"><a href="/2018/02/04/20180204ProgrammingInGo1/">2018-02-04</a></time>
      
      
  
    <h1 class="title"><a href="/2018/02/04/20180204ProgrammingInGo1/">Go语言程序设计(1)</a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>有一点是要说明的,Java无意间成了更好的C++(开发角度来说),Go的目标则是充当更好的C,虽然垠神喷了又喷go的这与那,但作为一门工程师气息很重的语言,社区也越发强大的语言,为了更好的工程实践,需要深刻学习,并尝试替换后端难以维护的C写的后端.<br>最后,选择一门语言不是选择一门语言本身,更多的是选择社区.称为开发人员的社会性?</p>
<h2 id="第一章-举例"><a href="#第一章-举例" class="headerlink" title="第一章 举例"></a>第一章 举例</h2><p>Go的HelloWorld.go</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    who := <span class="string">"World!"</span></span><br><span class="line">    fmt.Println(<span class="string">"Hello"</span>, who)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="第二章-布尔与数值类型"><a href="#第二章-布尔与数值类型" class="headerlink" title="第二章 布尔与数值类型"></a>第二章 布尔与数值类型</h2><h3 id="2-1-基础"><a href="#2-1-基础" class="headerlink" title="2.1 基础"></a>2.1 基础</h3><h4 id="2-1-1-注释风格"><a href="#2-1-1-注释风格" class="headerlink" title="2.1.1 注释风格"></a>2.1.1 注释风格</h4><ul>
<li>采用了C的方式,行注释为//,块注释为/**/</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//行注释</span></span><br><span class="line"><span class="comment">//fmt.Println("Hello!")</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*块注释*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">fmt.Println("Hello!")</span></span><br><span class="line"><span class="comment">fmt.Println("World!")</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<ul>
<li>同样的块注释也不可以嵌套比如下面的代码会报错</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*块注释</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">fmt.Println("Hello!")</span></span><br><span class="line"><span class="comment">fmt.Println("World!")</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">*/</span><br><span class="line">syntax error: unexpected /, expecting expression</span><br></pre></td></tr></table></figure>
<h4 id="2-1-2-标识符"><a href="#2-1-2-标识符" class="headerlink" title="2.1.2 标识符"></a>2.1.2 标识符</h4><p>标识符需要使用字母为开头的,使用Unicode编码分类中的任何字符组成.<br>标识符不可以同关键字的名称相同.<br>标识符区分大小写,下面几个各不相同</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hello</span><br><span class="line">Hello <span class="comment">//其中该以大写字母开头的标识符是公开的,其他的为私有的.</span></span><br><span class="line">hEllo</span><br></pre></td></tr></table></figure>
<p>其中下划线’_’在go中为占位符,当在调用一个赋值操作的时候,使用占位符,则忽略该值,被赋值的值保持原来的值, 如下所示</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">count, err = fmt.Println(x) <span class="comment">//获取打印的字节数和error值</span></span><br><span class="line">count, _ = fmt.Println(x) <span class="comment">//忽略error值</span></span><br></pre></td></tr></table></figure>
<h4 id="2-1-3-常量和变量"><a href="#2-1-3-常量和变量" class="headerlink" title="2.1.3 常量和变量"></a>2.1.3 常量和变量</h4><ul>
<li>变量声明与赋值</li>
</ul>
<p>由于go是强类型的语言,变量使用前必须要进行声明和赋值,如果用户不进行赋值,则默认置为0(整形等)或””(字符串)或nil(指针),不用担心C语言中的垃圾值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//正确做法1</span></span><br><span class="line"><span class="keyword">var</span> i <span class="keyword">int</span></span><br><span class="line">i = <span class="number">10</span> <span class="comment">//变量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//正确做法2</span></span><br><span class="line"><span class="keyword">var</span> i <span class="keyword">int</span> = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//正确做法3, 由于赋值的时候可以通过赋值符号右边的值进行类型推倒</span></span><br><span class="line"><span class="keyword">var</span> i = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//正确做法4, 最简单的方法, :=表明声明为变量并进行类型推倒,最终赋值,于是可以省略var</span></span><br><span class="line">i := <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//错误示范1,在声明的时候没有指定类型</span></span><br><span class="line"><span class="keyword">var</span> i</span><br><span class="line">i = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//错误示范2,不声明直接赋值</span></span><br><span class="line">i = <span class="number">10</span></span><br></pre></td></tr></table></figure>
<ul>
<li>常量声明和赋值</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//正确做法1</span></span><br><span class="line"><span class="keyword">const</span> x = <span class="number">0</span></span><br><span class="line"><span class="keyword">const</span> y = <span class="number">1</span></span><br><span class="line"><span class="keyword">const</span> z = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//正确做法2, 可以使用小括号的方式来声明一组变量</span></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    x = <span class="number">0</span></span><br><span class="line">    y = <span class="number">1</span></span><br><span class="line">    z = <span class="number">2</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//正确做法3,将括号内声明的变量初始化为一个值,下面的x y z 均初始化为0</span></span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">    x = <span class="number">0</span></span><br><span class="line">    y</span><br><span class="line">    z</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//正确做法4, 使用iota标识符进行初始化,</span></span><br><span class="line"><span class="comment">//iota是一个无类型整数常量,每次const关键字出现的时候,其值自增1</span></span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">    x = <span class="literal">iota</span></span><br><span class="line">    y</span><br><span class="line">    z</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//即</span></span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">    x = <span class="literal">iota</span> <span class="comment">// 0</span></span><br><span class="line">    y = <span class="literal">iota</span> <span class="comment">// 1</span></span><br><span class="line">    z = <span class="literal">iota</span> <span class="comment">// 2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//错误1, :=符号无法用在const初始化中</span></span><br><span class="line"><span class="keyword">const</span> x := <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//错误2, 未初始化完成就使用, 必须声明初始化一起完成</span></span><br><span class="line"><span class="keyword">const</span> x</span><br><span class="line">x = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h3 id="2-2-布尔值和布尔表达式"><a href="#2-2-布尔值和布尔表达式" class="headerlink" title="2.2 布尔值和布尔表达式"></a>2.2 布尔值和布尔表达式</h3><ul>
<li>布尔值:true和false</li>
<li>布尔表达式:</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">!b</span><br><span class="line">a||b</span><br><span class="line">a&amp;&amp;b</span><br><span class="line">x&lt;y</span><br><span class="line">x&gt;y</span><br></pre></td></tr></table></figure>
<p>需要注意的是==和!=可以比较任何两个类型,只要被比较的双方兼容这两个操作符<br>&lt; &lt;= &gt;= &gt;只能比较数字和字符串</p>
<h3 id="2-3-数值类型"><a href="#2-3-数值类型" class="headerlink" title="2.3 数值类型"></a>2.3 数值类型</h3><p>不同的类型之间不允许进行二进制运算和比较操作,在操作之前必须转为相同的类型</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//错误1, 两个不同类型之间, 不可以进行运算</span></span><br><span class="line">x := <span class="number">1</span> <span class="comment">//自动推断为int类型</span></span><br><span class="line">y := <span class="keyword">int16</span>(<span class="number">2</span>)</span><br><span class="line">z := x + y</span><br><span class="line"></span><br><span class="line"><span class="comment">//正确</span></span><br><span class="line">x := <span class="number">1</span></span><br><span class="line">y := <span class="keyword">int16</span>(<span class="number">2</span>)</span><br><span class="line">z := x + <span class="keyword">int</span>(y)</span><br></pre></td></tr></table></figure>
<p>其他的算术运算符</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x++ <span class="comment">//没有++x</span></span><br><span class="line">x--</span><br><span class="line">x /= y <span class="comment">//x/y的结果返回给x,如果分母为0,发出异常,如果两个值为整数,丢弃余数</span></span><br></pre></td></tr></table></figure>
<h4 id="2-3-1整型"><a href="#2-3-1整型" class="headerlink" title="2.3.1整型"></a>2.3.1整型</h4><ul>
<li>有符号的类型</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> <span class="keyword">int8</span> <span class="keyword">int32</span> <span class="keyword">int64</span></span><br><span class="line"><span class="keyword">int</span><span class="comment">//默认是int32或者是int64 依赖平台</span></span><br></pre></td></tr></table></figure>
<ul>
<li>无符号的类型</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">uint</span> <span class="keyword">uint8</span> <span class="keyword">uint32</span> <span class="keyword">uint64</span></span><br><span class="line"><span class="keyword">byte</span><span class="comment">//等于uint8</span></span><br><span class="line"><span class="keyword">rune</span> <span class="comment">//等于uint32</span></span><br><span class="line"><span class="keyword">uintptr</span><span class="comment">//(32位下uint32 64位下uint64)</span></span><br></pre></td></tr></table></figure>
<p>需要注意的是 默认使用int就足够,并且其速度是可以保证的<br>将小的整数转换为大整数总是安全的,但是如果向下转换会产生截断或者得到一个不可预期的值,如果想使用一个完美的精度,可以使用big.Rat或者big.Int类型,该类型只受限于机器的内存大小</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://book.douban.com/subject/24869910/" target="_blank" rel="noopener">Go语言程序设计</a></p>
<hr>
<p>版权声明:本文由littleji.com创作并发表,转载请注明作者及出处,欢迎关注公众号:littleji_com<br><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">本文遵守CC BY0SA 4.0</a><br>if you have any questions, please leave a message behind or give an <a href="https://github.com/littleji/littleji.github.io/issues" target="_blank" rel="noopener">issue</a></p>
<p>本文链接为：<a href="http://littleji.com/2018/02/04/20180204ProgrammingInGo1/">http://littleji.com/2018/02/04/20180204ProgrammingInGo1/</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2018-01-17T16:00:00.000Z"><a href="/2018/01/18/20180117BitCoin/">2018-01-18</a></time>
      
      
  
    <h1 class="title"><a href="/2018/01/18/20180117BitCoin/">比特币白皮书</a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="比特币白皮书"><a href="#比特币白皮书" class="headerlink" title="比特币白皮书"></a>比特币白皮书</h1><h2 id="0x00摘要"><a href="#0x00摘要" class="headerlink" title="0x00摘要"></a>0x00摘要</h2><p>一个真正意义上的点对点的在线电子交易系统，应该满足交易的双方在不需第三方金融机构介入的情况下进行。虽说数字签名技术，部分解决了这个问题，但是又需要面临，在离线交易过程中可能出现的“重复支付”（double-spending ）问题。我们在这里给出了一种解决的办法，这种方法将网络时间戳通过hash转换，加入到一种基于hash的、持续伸展的“工作证明链”（以下简称工作链）中。攻击者除非能够将之前所做的工作再做一遍，否则无法更改这个工作证明链中已有的工作证明记录。也就是说，最长的工作链一方面证明了其见证了最多的交易记录，另一方面也说明了其所掌握的CPU计算能力（译注：HASH的计算能力）。只要大多数的CPU计算能力掌握在各个交易的个体手中，那么攻击者无法对该交易网络进行攻击。当然，这个交易系统也需要最基本的结构，个个节点也会最大范围的通知自己所记录的交易行为。由于最长的工作链存有所有的交易记录，所以每个节点可以在任意的时间脱离或者回到这个交易系统，而不会丢失其未曾见证的交易记录。</p>
<h2 id="0x01说明"><a href="#0x01说明" class="headerlink" title="0x01说明"></a>0x01说明</h2><p>目前，互联网上的电子商务几乎完全依赖作为可信第三方的金融机构来处理电子支付。在大多数情况下，该交易模式可以应对，但它仍然受到基于信任模型的固有弱点的影响。比如，不可避免的调解纠纷，而调解成本又增加了交易成本，限制了最小的实际交易规模，并且切断了小型临时交易的可能性。尤其是，当需要运作而又无法正常的运作一笔“不可逆的交易”时，交易成本会大大的增加。由于该系统的提供信息有可能存在掺了假的或者过时的信息，所以交易的双方都需要花更多的成本在获取双方的信任上，进一步增加了交易的成本。这种交易机制在没有任何可信任的第三方见证的情况下，交易无法进行下去。<br>事实上，目前所需要的是一种基于密码证明而不是信任的电子支付系统，这个系统允许任何两个愿意相互交易的双方，在不需要可信任的第三方的情况下进行交易。一方面，由于在实施欺骗需要付出巨大的计算代价，从而保护了卖家免受欺诈；另一方面，使容易被采用的常规托管机制，来保护买家。在本文中，我们提出了一个解决重复支付问题的解决方案，这个方案使用分布式时间戳服务器来顺序生成基于交易时间的工作证明。并且只要该系统中的所有坏人节点的计算能力不超过系统内的其他节点，那么就能保证这个系统是安全的。（译注：51%攻击）</p>
<h2 id="0x02交易"><a href="#0x02交易" class="headerlink" title="0x02交易"></a>0x02交易</h2><p>这里定义一种电子货币保存一系列的数字签名。在交易的过程中，交易中的付款方首先将之前的交易与付款方的公钥一同进行hash，最终添加到付款方所持有的电子货币中，并传给收款方，收款方使用付款方的公钥对该电子货币进行验证是否为收款方的身份。<br>问题在于，收款方无法确认付款方是否多花了钱。一般的解决方法是引入一个可信的第三方，或者说造币厂，对每一笔交易进行审查。具体过程是，每一笔交易发生时，付款方将所持有的货币传回给造币厂，造币厂则将这个货币摧毁，产生一个新的货币给收款方。这样以来，整个交易的过程安全性完全依赖于造币厂。<br>而我们需要一种让收款者知道付款方没有进行二次交易。为了这个目的，我们可以在交易的过程中认为，只有最早的那笔交易是算数的，这样避免了二次交易情况的发生。收款方通过遍历所有的交易来验证付款方发出交易请求而收款方没有收到这一情况。要想脱离造币厂的模型，交易必须被广而告之，并且需要一个系统来帮助所有的参与者决策交易的到达顺序，收款方在判断一个交易的到达时间时需要这个系统内的其他节点进行投票决定，少数服从多数。</p>
<h2 id="0x03时间戳服务器"><a href="#0x03时间戳服务器" class="headerlink" title="0x03时间戳服务器"></a>0x03时间戳服务器</h2><p>时间戳服务器是一切的开始，时间戳服务器工作原理是对一个block进行hash，并对其结果进行广播。建立时间戳服务器的意义主要是为了证明某一个数据在一个时间点一定存在。在组成一个链的时候，每一个时间戳的生成都会考虑到之前时间戳的信息。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://bitcoin.org/bitcoin.pdf" target="_blank" rel="noopener">比特币白皮书</a></p>
<hr>
<p>版权声明:本文由littleji.com创作并发表,转载请注明作者及出处,欢迎关注公众号:littleji_com<br><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">本文遵守CC BY0SA 4.0</a><br>if you have any questions, please leave a message behind or give an <a href="https://github.com/littleji/littleji.github.io/issues" target="_blank" rel="noopener">issue</a></p>
<p>本文链接为：<a href="http://littleji.com/2018/01/18/20180117BitCoin/">http://littleji.com/2018/01/18/20180117BitCoin/</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2018-01-13T16:00:00.000Z"><a href="/2018/01/14/20180114ThereAndBackAgain/">2018-01-14</a></time>
      
      
  
    <h1 class="title"><a href="/2018/01/14/20180114ThereAndBackAgain/">舍得</a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="0x00-写在前面"><a href="#0x00-写在前面" class="headerlink" title="0x00 写在前面"></a>0x00 写在前面</h1><p>2017,眨眼便逝.</p>
<p>今年文章产出为1,无法回避这个问题,为什么呢?懒亦有了些自知之明.</p>
<ol>
<li>懒是自制力的问题,这也是我自身亟待解决的问题,事实上在自身的方法论体系中对于自我的改造,自制力是要排在第一位的,没有自制力之后的所有学习方法都无法展开,或者说将事倍功半,可以说是内功中的”易筋经”,俗话说:脱胎换骨,内壮神勇.</li>
<li>由于在网上或书上看了不少的文章,发现均是良莠不齐,而这人一旦有了坏名声,再想改变人们的坏印象那可难喽.于是我心中也忐忑起来,不敢再有所造次.怕是污了各位看官的火眼.但又觉得污不污的也是真我,到了这把年纪再不折腾,怕是没时间了.</li>
</ol>
<p>那在这个年初,便总结下有得有失的这一年:得是侥幸,失则是得的对立.</p>
<p>下面列举这一年几个对我影响较深思考:</p>
<ol>
<li>舍得,有舍方有得.</li>
<li>选择、方法、努力缺一不可.</li>
<li>极小点.</li>
<li>人本身是工作问题的思考前提.</li>
<li>参差多态乃是幸福本源.</li>
<li>复盘,真正地找到自身的不足.</li>
<li>决定你的不是你,而是你的周遭.</li>
</ol>
<p>上面几项,并非完全独立的关系,比如复盘于我自身的知识体系中在方法-实践方法-学习方法中.</p>
<p>下面简单地讲讲我对舍得的理解,其他几个留到之后一一细谈.</p>
<h1 id="0x01-舍得也是公平"><a href="#0x01-舍得也是公平" class="headerlink" title="0x01 舍得也是公平"></a>0x01 舍得也是公平</h1><p>舍得舍得,有舍有得.其实跟此相似的概念还有等价交换.</p>
<p>舍得讲的是公平问题,这也是基本的商品交换规律,只有付出什么才能等到什么. </p>
<p>马云也说过：“员工离职就是两点：1.钱没给够 2.干的不爽”，事实上合起来也是公平二字，只不过一方面说的是钱，另一方面说的是心境。</p>
<p>供求双方在平等的条件下进行对彼此均有益的交易,符合囚徒理论中”双赢”的概念,双方在均获得一定利润的情况下,继续在合作巩固社会发展.</p>
<p>但理论归理论,实际上孰不想独拿那份最大的蛋糕?</p>
<p>举个生活中的例子:老板付工资,员工ABC干活.其中ABC干的是同一种活.<br>其中老板付出总共15000的情况下,公司的总利润是1500,其中,A正常工作、B偷懒工作、C勤奋工作.</p>
<h2 id="0x0101-A与老板的地位平等"><a href="#0x0101-A与老板的地位平等" class="headerlink" title="0x0101 A与老板的地位平等"></a>0x0101 A与老板的地位平等</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">老板付出5000的工资,得到了员工A产出的5500的收益.老板很高兴.</span><br><span class="line">员工A正常工作,付出4500的精力,得到了老板给出的5000的工资.员工A很开心.</span><br><span class="line">二者携手共创美好的明天.</span><br></pre></td></tr></table></figure>
<h2 id="0x0102-B、C与老板之前地位不平等"><a href="#0x0102-B、C与老板之前地位不平等" class="headerlink" title="0x0102 B、C与老板之前地位不平等"></a>0x0102 B、C与老板之前地位不平等</h2><p>还是上面的例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">员工B偷懒,员工C勤奋.</span><br><span class="line">员工B由于频繁偷懒,拿着5000的工资,付出4500精力，产出了5000的收益.员工地位被抬高，老板觉得自己的利益受到侵害，很生气将其开除.</span><br><span class="line">员工C由于非常勤奋,拿着5000的工资,付出了5500精力，产出了6000的收益.老板地位被抬高，员工觉得干了那么多活，依然拿着一样的工资，心生委屈愤而离职.</span><br></pre></td></tr></table></figure></p>
<p>由此发现,由于两个员工离职,老板的利润只有每个月500,事实上比之前ABC三个员工均在时的收益1500降低了2/3.双方不平等的的结果只有双输：老板收益降低，员工没了工作。</p>
<h2 id="0x0103-该怎么做？"><a href="#0x0103-该怎么做？" class="headerlink" title="0x0103 该怎么做？"></a>0x0103 该怎么做？</h2><p>无他，对于交易的双方来说，都应该关注好交易的彼此，莫让对方受了委屈，才是持续推动双方进步的不二法门。切莫为了蝇头甜点，预支了未来的大块蛋糕。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="http://wiki.mbalib.com/wiki/%E7%AD%89%E4%BB%B7%E4%BA%A4%E6%8D%A2" target="_blank" rel="noopener">等价交换</a></p>
<hr>
<p>版权声明:本文由littleji.com创作并发表,转载请注明作者及出处,欢迎关注公众号:littleji_com<br><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">本文遵守CC BY0SA 4.0</a><br>if you have any questions, please leave a message behind or give an <a href="https://github.com/littleji/littleji.github.io/issues" target="_blank" rel="noopener">issue</a></p>
<p>本文链接为：<a href="http://littleji.com/2018/01/14/20180114ThereAndBackAgain/">http://littleji.com/2018/01/14/20180114ThereAndBackAgain/</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2017-05-10T09:50:20.000Z"><a href="/2017/05/10/20170510MyBookList/">2017-05-10</a></time>
      
      
  
    <h1 class="title"><a href="/2017/05/10/20170510MyBookList/">我的程序员书单(My Programmer Book List)</a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h1><p>程序员实用算法 原书<br>算法导论-&gt;大餐 9.4<br>Algorithms Unlocked-&gt;开胃<br>算法引论——一种创造性方法（建议先看第5章，真是爽爆了）<br>The Science of Programming<br>求解数学题《怎样解题》<br>计算机程序设计艺术 9.3<br>基础数学 9.5<br>怎样解题 9.1<br>An Introduction to Probability Theory and Its Applications, Vol. 1, 3rd Edition 9.6<br>如何求解问题 8.5<br>数理逻辑 8.9<br>集合论基础 9.1<br>概率论及其应用 9.1<br>图论导引 8.8<br>来自圣经的证明 9.4</p>
<h1 id="计算机原理"><a href="#计算机原理" class="headerlink" title="计算机原理"></a>计算机原理</h1><p>计算机程序的构造与解释 9.5<br>领域特定语言 9.1<br>编译原理 9.1</p>
<h1 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h1><p>Effective Akka<br>Java 8 in action<br>java puzz<br>java 并发编程实战 9.0<br>effective java 9.1</p>
<h1 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h1><p>Learning Python<br>Python Programming</p>
<h1 id="C-C"><a href="#C-C" class="headerlink" title="C/C++"></a>C/C++</h1><p>Effective C++/STL</p>
<h1 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h1><p>高性能MySQL 第三版</p>
<h1 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h1><p>白帽子讲web安全 8.2<br>黑客攻防技术宝典：web实战篇(第2版) 8.6<br>加密与解密(第3版) 8.4<br>Web之困 - 现代Web应用安全指南<br>Web前端黑客技术揭秘<br>码的奥秘 9.2<br>Web安全深度剖析 7.9<br>SQL注入攻击与防御（第2版） 7.8<br>精通脚本黑客 8.0<br>0day安全 （第2版） 8.4<br>社会工程 8.0</p>
<h1 id="软件工程"><a href="#软件工程" class="headerlink" title="软件工程"></a>软件工程</h1><p>教科书:构建之法<a href="http://www.cnblogs.com/xinz/p/4470424.html" target="_blank" rel="noopener">构建之法中提到的书单</a><br>参考书:代码大全 Rapid Development 快速软件开发 项目管理艺术 人件<br>敏捷软件开发 原则，模式与实践<br>硝烟中的Scrum和XP : 我们如何实施Scrum 8.6<br>认知与设计 8.6<br>门后的秘密 8.2<br>点石成金 8.5<br>启示录 8.5<br>项目百态 8.3<br>精益开发实战 8.3<br>敏捷武士 7.7<br>敏捷软件开发 9.1<br>持续交付 8.6<br>精益企业 8.8<br>精益思想 8.6<br>看板方法 7.8<br>系统的思考 8.0<br>管理3.0 8.0<br>第五项修炼</p>
<h1 id="UI设计"><a href="#UI设计" class="headerlink" title="UI设计"></a>UI设计</h1><p>简约至上 8.4</p>
<h1 id="营销"><a href="#营销" class="headerlink" title="营销"></a>营销</h1><p>增长黑客 7.9</p>
<h1 id="标准"><a href="#标准" class="headerlink" title="标准"></a>标准</h1><p>HTTP 权威指南 8.7<br>TCP/IP详解 9.2</p>
<h2 id="软件设计"><a href="#软件设计" class="headerlink" title="软件设计"></a>软件设计</h2><p>设计模式 : 可复用面向对象软件的基础 9.4<br>企业应用架构模式 9.0<br>软件框架设计的艺术<br>发布!软件的设计与部署 7.7<br>实现领域驱动设计 8.8</p>
<h1 id="运维"><a href="#运维" class="headerlink" title="运维"></a>运维</h1><p>网站运维 8.3</p>
<h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1><p>Google软件测试之道 8.1</p>
<h1 id="程序员实践"><a href="#程序员实践" class="headerlink" title="程序员实践"></a>程序员实践</h1><p>卓有成效的程序员<br>高效程序员的修炼<br>程序员的思维训练 8.3<br>程序员的职业素养 8.6<br>高效程序员的45个习惯——敏捷开发修炼之道<br>程序员修炼之道——从小工到专家<br>重构 9.0(《重构与模式》一样，充其量只是一本案例集，无法达到《重构》的高度)<br>编写可读代码的艺术 8.6<br>编程珠玑 9.2<br>编码 9.2</p>
<h1 id="程序员泛读"><a href="#程序员泛读" class="headerlink" title="程序员泛读"></a>程序员泛读</h1><p>哥德尔、艾舍尔、巴赫 9.4<br>暗时间 8.4<br>把时间当朋友<br>影响力 8.6<br>黑客 8.3<br>编程人生 8.4</p>
<hr>
<p>版权声明:本文由littleji.com创作并发表,转载请注明作者及出处,欢迎关注公众号:littleji_com<br><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">本文遵守CC BY0SA 4.0</a><br>if you have any questions, please leave a message behind or give an <a href="https://github.com/littleji/littleji.github.io/issues" target="_blank" rel="noopener">issue</a></p>
<p>本文链接为：<a href="http://littleji.com/2017/05/10/20170510MyBookList/">http://littleji.com/2017/05/10/20170510MyBookList/</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-12-19T09:50:20.000Z"><a href="/2016/12/19/20161219MySQL-#1146-#1017/">2016-12-19</a></time>
      
      
  
    <h1 class="title"><a href="/2016/12/19/20161219MySQL-#1146-#1017/">使用navicat 修改MySQL数据库的某个表后,无法再读取该表(MySQL-#1146-#1017)</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="概述-abstract"><a href="#概述-abstract" class="headerlink" title="概述(abstract)"></a>概述(abstract)</h2><p>问题的产生原因是由于在Windows下使用Navicat客户端,操作位于CentOS上MySQL 5.6时,具体的执行一个重命名字段的操作时,Navicat停止了运行,然后将该Navicat强制的关闭后,再运行Navicat打开刚才重命名字段所在的表,再次卡死,反复操作几次,结果并没有改变.</p>
<h2 id="解决1-figure-it-1"><a href="#解决1-figure-it-1" class="headerlink" title="解决1(figure it 1)"></a>解决1(figure it 1)</h2><p>首先,去MySQL数据库所在的服务器,对MySQL服务进行重启<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld restart</span><br></pre></td></tr></table></figure></p>
<p>再去用Navicat操作MySQL ,报 ERROR 1146 table ‘’ doesn’t exist 的错误</p>
<h2 id="解决2-figure-it-2"><a href="#解决2-figure-it-2" class="headerlink" title="解决2(figure it 2)"></a>解决2(figure it 2)</h2><p>之后,通过查阅stackoverflow,可能是数据库文件权限的问题,然后照葫芦画瓢,使用下面的命令对其进行修改:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown mysql:mysql /var/lib/mysql/ci/*</span><br></pre></td></tr></table></figure></p>
<p>直接报,没有该文件</p>
<h2 id="解决3-figure-it-3"><a href="#解决3-figure-it-3" class="headerlink" title="解决3(figure it 3)"></a>解决3(figure it 3)</h2><p>需要通过下面的命令查询mysql data文件具体在什么位置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf</span><br></pre></td></tr></table></figure></p>
<p>找到下面这行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">datadir = /opt/mysql/db/data</span><br></pre></td></tr></table></figure></p>
<p>再通过语句修改对应数据表所在数据库的权限,比如出现错误的表所在数据库的名字是’tmp_db’<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown mysql:mysql /opt/mysql/db/data/tmp_db/*</span><br></pre></td></tr></table></figure></p>
<p>重新启动数据库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld restart</span><br></pre></td></tr></table></figure></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://stackoverflow.com/questions/6443428/cant-find-file-ci-users-frm-errno-13" target="_blank" rel="noopener">stackoverflow#1</a></p>
<hr>
<p>版权声明:本文由littleji.com创作并发表,转载请注明作者及出处,欢迎关注公众号:littleji_com<br><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">本文遵守CC BY0SA 4.0</a><br>if you have any questions, please leave a message behind or give an <a href="https://github.com/littleji/littleji.github.io/issues" target="_blank" rel="noopener">issue</a></p>
<p>本文链接为：<a href="http://littleji.com/2016/12/19/20161219MySQL-#1146-#1017/">http://littleji.com/2016/12/19/20161219MySQL-#1146-#1017/</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-12-12T11:50:20.000Z"><a href="/2016/12/12/20161212UseJsonRPCFormatToGetWhatYouWant/">2016-12-12</a></time>
      
      
  
    <h1 class="title"><a href="/2016/12/12/20161212UseJsonRPCFormatToGetWhatYouWant/">json-rpc的标准调用(UseJsonRPCFormatToGetWhatYouWant)</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>本文承接上文的<a href="http://littleji.com/2016/12/06/QuickStartForJsonrpc4j/">jsonrpc4j初步使用</a>,在知道了如何部署Server端以及通过Java的接口调用部署的服务后,下面就是通过json-rpc本身的标准来实际的调用rpc借口和处理返回的相关信息.</p>
<h2 id="json-rpc的标准详细说明"><a href="#json-rpc的标准详细说明" class="headerlink" title="json-rpc的标准详细说明"></a>json-rpc的标准详细说明</h2><p>这方面具体请参考:</p>
<ol>
<li><a href="http://wiki.geekdream.com/Specification/json-rpc_2.0.html" target="_blank" rel="noopener">中文</a></li>
<li><a href="http://www.json.org/" target="_blank" rel="noopener">English</a><br>这里拿出一些必要且简单的说明.</li>
</ol>
<h2 id="rpc请求所必要的参数"><a href="#rpc请求所必要的参数" class="headerlink" title="rpc请求所必要的参数"></a>rpc请求所必要的参数</h2><ol>
<li>请求的对象需要通过json的格式发往server端</li>
<li>请求对象需要包括下面四个对象<ol>
<li>jsonrpc:来说明所使用的JSON-RPC的版本</li>
<li>methode:来说明说调用的方法名称</li>
<li>params:调用方法的结构化参数值</li>
<li>id:来唯一的表明发起的请求,客户端同样通过这个id来唯一的表示响应的信息,这个id可以是字符串,数字和NULL.如果没有这个值则认为这个请求是一个通知</li>
</ol>
</li>
</ol>
<h2 id="rpc响应所必要的参数"><a href="#rpc响应所必要的参数" class="headerlink" title="rpc响应所必要的参数"></a>rpc响应所必要的参数</h2><ol>
<li>jsonrpc:同请求</li>
<li>result: 如果一个请求成功的调用了方法,则必须有这一项,否则不必有这一项</li>
<li>error:错误的对象.如果一个方法失败了,必须有该项,否则不必有</li>
<li>id:该成员必须有,同请求.</li>
</ol>
<h2 id="错误对象所必要的参数"><a href="#错误对象所必要的参数" class="headerlink" title="错误对象所必要的参数"></a>错误对象所必要的参数</h2><ol>
<li>code:使用整数来表明的异常错误类型,-32768到-32000为保留的错误代码,详细的错误代码所对应的解释请参考 <a href="http://wiki.geekdream.com/Specification/json-rpc_2.0.html" target="_blank" rel="noopener">中文</a></li>
<li>message:描述错误信息</li>
<li>data:包含错误复杂信息的成员,可忽略.</li>
</ol>
<h2 id="使用curl来测试已经建立的json-rpc服务"><a href="#使用curl来测试已经建立的json-rpc服务" class="headerlink" title="使用curl来测试已经建立的json-rpc服务"></a>使用curl来测试已经建立的json-rpc服务</h2><ul>
<li>需要按照前文,建立好对应的服务</li>
</ul>
<h3 id="测试单个请求"><a href="#测试单个请求" class="headerlink" title="测试单个请求"></a>测试单个请求</h3><p>通过使用curl来发送http的请求,当然也可以通过java的HttpClient来发送,假设RpcServer部署相应的服务,且url为<code>/rpc</code>,我们使用server端的”getString”方法,server端部署在192.168.1.10的8080端口上,那么代码如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST &quot;http://192.168.1.10:8080/rpc&quot; -d &quot;&#123;&quot;jsonrpc&quot;:&quot;2.0&quot;, &quot;id&quot;:&quot;10&quot;, &quot;method&quot;:&quot;getString&quot;, &quot;params&quot;:[&quot;Test&quot;]&#125;&quot;</span><br></pre></td></tr></table></figure></p>
<p>可以看到服务端返回这样的信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;jsonrpc&quot;:&quot;jsonrpc&quot;,&quot;id&quot;:&quot;null&quot;,&quot;error&quot;:&#123;&quot;code&quot;:-32700,&quot;message&quot;:&quot;JSON parse error&quot;&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p>说明发送的信息不是一个合法的JSON串,检查后发现因为curl发送数据的问题,需要对引号进行转义,更改后的请求命令如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST &quot;http://192.168.1.10:8080/rpc&quot; -d &quot;&#123;\&quot;jsonrpc\&quot;:\&quot;2.0\&quot;, \&quot;id\&quot;:\&quot;10\&quot;, \&quot;method\&quot;:\&quot;getString\&quot;, \&quot;params\&quot;:[\&quot;Test\&quot;]&#125;&quot;</span><br></pre></td></tr></table></figure></p>
<p>服务端返回信息:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:&quot;10&quot;,&quot;result&quot;:&quot;&#123;Test&#125;&quot;&#125;</span><br></pre></td></tr></table></figure></p>
<p>信息正常的返回了,说明调用成功</p>
<h3 id="测试批的方式发送请求"><a href="#测试批的方式发送请求" class="headerlink" title="测试批的方式发送请求"></a>测试批的方式发送请求</h3><p>原理非常简单,只需要将发送的一组请求使用数组的形式括起来即可,代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST &quot;http://192.168.101.188:8080/rpc&quot; -d &quot;[&#123;\&quot;jsonrpc\&quot;:\&quot;2.0\&quot;, \&quot;id\&quot;:\&quot;1\&quot;, \&quot;method\&quot;:\&quot;getString\&quot;, \&quot;params\&quot;:[\&quot;Test\&quot;]&#125;,&#123;\&quot;jsonrpc\&quot;:\&quot;2.0\&quot;, \&quot;id\&quot;:\&quot;2\&quot;, \&quot;method\&quot;:\&quot;getString\&quot;, \&quot;params\&quot;:[\&quot;哈哈\&quot;]&#125;]&quot;</span><br></pre></td></tr></table></figure></p>
<p>服务端返回:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[&#123;&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:&quot;1&quot;,&quot;result&quot;:&quot;&#123;Test&#125;&quot;&#125;</span><br><span class="line">,&#123;&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:&quot;2&quot;,&quot;result&quot;:&quot;&#123;哈哈&#125;&quot;&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<p>版权声明:本文由littleji.com创作并发表,转载请注明作者及出处,欢迎关注公众号:littleji_com<br><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">本文遵守CC BY0SA 4.0</a><br>if you have any questions, please leave a message behind or give an <a href="https://github.com/littleji/littleji.github.io/issues" target="_blank" rel="noopener">issue</a></p>
<p>本文链接为：<a href="http://littleji.com/2016/12/12/20161212UseJsonRPCFormatToGetWhatYouWant/">http://littleji.com/2016/12/12/20161212UseJsonRPCFormatToGetWhatYouWant/</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-12-06T11:50:20.000Z"><a href="/2016/12/06/20161206QuickStartForJsonrpc4j/">2016-12-06</a></time>
      
      
  
    <h1 class="title"><a href="/2016/12/06/20161206QuickStartForJsonrpc4j/">jsonrpc4j初步使用(Quick Start For Jsonrpc4j)</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>目前有个项目需要向外提供服务:</p>
<ol>
<li>不打算用spring相对来说比较重的框架</li>
<li>后来考虑过jersey+jetty的restful框架,但是restful本身的应用场景,或者说是抽象较为局限,主要是编者水平有限</li>
<li>再之后又看了thrift的使用,稍微上手,认为操作还是较为繁杂.</li>
<li>json-rpc以前并没有接触过,json相对来说又有传输占用带宽较小等广为人知的优点,便以此篇为个契机学习一下.<br>jsonrpc4j是briandilley开发,项目的地址是<a href="https://github.com/briandilley/jsonrpc4j" target="_blank" rel="noopener">github</a><br>jsonrpc4j 服从json-rpc的规范,<a href="http://www.jsonrpc.org/" target="_blank" rel="noopener">规范链接在此</a><br>其主要支持下面这4类客户端:<br>Streaming server (InputStream \ OutputStream)<br>HTTP Server (HttpServletRequest \ HttpServletResponse)<br>Portlet Server (ResourceRequest \ ResourceResponse)<br>Socket Server (StreamServer)<br>这次主要使用的是HTTP Server</li>
</ol>
<h2 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h2><p>jsonrpc项目通过Maven构建,首先需要在pom.xm中加入对jsonrpc4j的依赖,如下面所示:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- jsonrpc4j --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.github.briandilley.jsonrpc4j&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jsonrpc4j&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.4.6&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<p>但是仅仅加入上面的依赖还不够,完整的pom.xml如下所示:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;groupId&gt;com.littleji&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jsonrpc-demo&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.github.briandilley.jsonrpc4j&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jsonrpc4j&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.4.6&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jackson-core&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.7.2&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.7.2&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.7.2&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.7.2&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.7.9&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"> </span><br><span class="line">        &lt;!-- https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.1.0&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;httpcore-nio&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.4.4&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;commons-codec&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;commons-codec&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.10&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!-- https://mvnrepository.com/artifact/javax.portlet/portlet-api --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;javax.portlet&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;portlet-api&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.0&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;net.iharder&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;base64&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.3.9&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="配置测试用的model-service"><a href="#配置测试用的model-service" class="headerlink" title="配置测试用的model,service"></a>配置测试用的model,service</h2><h3 id="model"><a href="#model" class="headerlink" title="model"></a>model</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package com.littleji.jsonrpc.demo;</span><br><span class="line"> </span><br><span class="line">import java.io.Serializable;</span><br><span class="line"> </span><br><span class="line">public class DemoBean implements Serializable&#123;</span><br><span class="line">    private static final long serialVersionUID = -5141784935371524L;</span><br><span class="line">    private int code;</span><br><span class="line">    private String msg;</span><br><span class="line"> </span><br><span class="line">    public int getCode() &#123;</span><br><span class="line">        return code;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public void setCode(int code) &#123;</span><br><span class="line">        this.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public String getMsg() &#123;</span><br><span class="line">        return msg;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public void setMsg(String msg) &#123;</span><br><span class="line">        this.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Service和其Implement"><a href="#Service和其Implement" class="headerlink" title="Service和其Implement"></a>Service和其Implement</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package com.littleji.jsonrpc.demo;</span><br><span class="line"> </span><br><span class="line">/**</span><br><span class="line">* Created by Jimmy on 2016/12/6.</span><br><span class="line">*/</span><br><span class="line">public interface DemoService &#123;</span><br><span class="line">        public DemoBean getDemo(String code, String msg);</span><br><span class="line"> </span><br><span class="line">        public Integer getInt(Integer code);</span><br><span class="line"> </span><br><span class="line">        public String getString(String msg);</span><br><span class="line"> </span><br><span class="line">        public void doSomething();</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public class DemoServiceImply implements DemoService &#123;</span><br><span class="line"> </span><br><span class="line">    public DemoBean getDemo(String code, String msg) &#123;</span><br><span class="line">        DemoBean bean1 = new DemoBean();</span><br><span class="line">        bean1.setCode(Integer.parseInt(code));</span><br><span class="line">        bean1.setMsg(msg);</span><br><span class="line">        return bean1;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public Integer getInt(Integer code) &#123;</span><br><span class="line">        return code;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public String getString(String msg) &#123;</span><br><span class="line">        return &quot;&#123;&quot;+msg+&quot;&#125;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public void doSomething() &#123;</span><br><span class="line">        System.out.println(&quot;do something&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="配置server端"><a href="#配置server端" class="headerlink" title="配置server端"></a>配置server端</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">package com.littleji.jsonrpc.demo;</span><br><span class="line"> </span><br><span class="line">/**</span><br><span class="line">* Created by Jimmy on 2016/12/6.</span><br><span class="line">*/</span><br><span class="line">import java.io.IOException;</span><br><span class="line"> </span><br><span class="line">import javax.servlet.ServletConfig;</span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">import com.googlecode.jsonrpc4j.JsonRpcServer;</span><br><span class="line">import com.googlecode.jsonrpc4j.ProxyUtil;</span><br><span class="line"> </span><br><span class="line">public class RpcServer extends HttpServlet &#123;</span><br><span class="line">    private static final long serialVersionUID = 12341234345L;</span><br><span class="line">    private JsonRpcServer rpcServer = null;</span><br><span class="line">    private DemoService demoService = null;</span><br><span class="line"> </span><br><span class="line">    @Override</span><br><span class="line">    public void init(ServletConfig config) throws ServletException &#123;</span><br><span class="line">        super.init(config);</span><br><span class="line">        demoService = new DemoServiceImply();</span><br><span class="line">        Object compositeService = ProxyUtil.createCompositeServiceProxy(</span><br><span class="line">                this.getClass().getClassLoader(),</span><br><span class="line">                new Object[] &#123; demoService&#125;,</span><br><span class="line">                new Class&lt;?&gt;[] &#123; DemoService.class&#125;,</span><br><span class="line">                true);</span><br><span class="line"> </span><br><span class="line">        rpcServer = new JsonRpcServer(compositeService);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    @Override</span><br><span class="line">    protected void service(HttpServletRequest request,</span><br><span class="line">                           HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">        rpcServer.handle(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Servlet的web-xml"><a href="#Servlet的web-xml" class="headerlink" title="Servlet的web.xml"></a>Servlet的web.xml</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE web-app PUBLIC</span><br><span class="line">&quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot;</span><br><span class="line">&quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot; &gt;</span><br><span class="line"> </span><br><span class="line">&lt;web-app&gt;</span><br><span class="line">  &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;</span><br><span class="line">  &lt;servlet&gt;</span><br><span class="line">      &lt;servlet-name&gt;RpcServer&lt;/servlet-name&gt;</span><br><span class="line">      &lt;display-name&gt;RpcServer&lt;/display-name&gt;</span><br><span class="line">      &lt;description&gt;&lt;/description&gt;</span><br><span class="line">      &lt;servlet-class&gt;com.littleji.jsonrpc.demo.RpcServer&lt;/servlet-class&gt;</span><br><span class="line">  &lt;/servlet&gt;</span><br><span class="line">  &lt;servlet-mapping&gt;</span><br><span class="line">      &lt;servlet-name&gt;RpcServer&lt;/servlet-name&gt;</span><br><span class="line">      &lt;url-pattern&gt;/rpc&lt;/url-pattern&gt;</span><br><span class="line">  &lt;/servlet-mapping&gt;</span><br><span class="line">&lt;/web-app&gt;</span><br></pre></td></tr></table></figure>
<h2 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">package com.littleji.jsonrpc.test;</span><br><span class="line"> </span><br><span class="line">import com.googlecode.jsonrpc4j.JsonRpcHttpClient;</span><br><span class="line">import com.googlecode.jsonrpc4j.ProxyUtil;</span><br><span class="line">import com.littleji.jsonrpc.demo.DemoService;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">import java.net.URL;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">/**</span><br><span class="line">* Created by Jimmy on 2016/12/7.</span><br><span class="line">*/</span><br><span class="line">public class jsonrpctest2 &#123;</span><br><span class="line">    public static void main(String [] args) throws Throwable &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            JsonRpcHttpClient client = new JsonRpcHttpClient(</span><br><span class="line">                    new URL(&quot;http://127.0.0.1:8080/rpc&quot;));</span><br><span class="line"> </span><br><span class="line">            DemoService userService = ProxyUtil.createClientProxy(</span><br><span class="line">                    client.getClass().getClassLoader(),</span><br><span class="line">                    DemoService.class,</span><br><span class="line">                    client);</span><br><span class="line">             //两种调用方式</span><br><span class="line">            System.out.println(userService.getString(&quot;aa&quot;));</span><br><span class="line">            System.out.println( client.invoke(&quot;getString&quot;, new String[] &#123; &quot;haha&quot; &#125;, String.class));</span><br><span class="line">            System.out.println( client.invoke(&quot;getInt&quot;, new Integer[] &#123; 2 &#125;, Integer.class));</span><br><span class="line"> </span><br><span class="line">        &#125;</span><br><span class="line">        catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Streaming-server-and-client"><a href="#Streaming-server-and-client" class="headerlink" title="Streaming server and client"></a>Streaming server and client</h2><p>jsonrpc4j 主要是通过流服务器和客户端来处理应用(不仅仅是HTTP)的请求,而<code>JsonRpcClient</code>和<code>JsonRpcServer</code>有一些简单的方法来获得输入和输出流,且在库中附带着一个JsonRpcHttpClient,用来扩展JsonRpcClient对于HTTP的支持</p>
<h2 id="Without-the-Spring-Framework"><a href="#Without-the-Spring-Framework" class="headerlink" title="Without the Spring Framework"></a>Without the Spring Framework</h2><p>jsonrpc4j可以不使用spring框架,事实上二者均可运行于Android环境中</p>
<h2 id="对测试的解释"><a href="#对测试的解释" class="headerlink" title="对测试的解释"></a>对测试的解释</h2><p>其实测试类就是一个客户端的简单使用<br>下面是一个客户端使用JSON-RPC服务的例子,具体如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">JsonRpcHttpClient client = new JsonRpcHttpClient(</span><br><span class="line">    new URL(&quot;http://example.com/UserService.json&quot;));</span><br><span class="line"> </span><br><span class="line">User user = client.invoke(&quot;createUser&quot;, new Object[] &#123; &quot;bob&quot;, &quot;the builder&quot; &#125;, User.class);</span><br></pre></td></tr></table></figure></p>
<p>或者使用ProxyUtil类结合接口,来创建一个动态的代理,如下所示:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">JsonRpcHttpClient client = new JsonRpcHttpClient(</span><br><span class="line">    new URL(&quot;http://example.com/UserService.json&quot;));</span><br><span class="line"> </span><br><span class="line">UserService userService = ProxyUtil.createClientProxy(</span><br><span class="line">    getClass().getClassLoader(),</span><br><span class="line">    UserService.class,</span><br><span class="line">    client);</span><br><span class="line"> </span><br><span class="line">User user = userService.createUser(&quot;bob&quot;, &quot;the builder&quot;);</span><br></pre></td></tr></table></figure></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://github.com/briandilley/jsonrpc4j" target="_blank" rel="noopener">jsonrpc4j</a><br><a href="http://blog.csdn.net/hjcenry/article/details/52440925" target="_blank" rel="noopener">JSON-RPC（jsonrpc4j）使用demo</a></p>
<hr>
<p>版权声明:本文由littleji.com创作并发表,转载请注明作者及出处,欢迎关注公众号:littleji_com<br><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">本文遵守CC BY0SA 4.0</a><br>if you have any questions, please leave a message behind or give an <a href="https://github.com/littleji/littleji.github.io/issues" target="_blank" rel="noopener">issue</a></p>
<p>本文链接为：<a href="http://littleji.com/2016/12/06/20161206QuickStartForJsonrpc4j/">http://littleji.com/2016/12/06/20161206QuickStartForJsonrpc4j/</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-12-01T02:40:20.000Z"><a href="/2016/12/01/20161201UseJavaApiForElasticSearch2/">2016-12-01</a></time>
      
      
  
    <h1 class="title"><a href="/2016/12/01/20161201UseJavaApiForElasticSearch2/">使用ElasticSearch的JavaAPI2(UseJavaApiForElasticSearch2)</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="单独文档的APIs"><a href="#单独文档的APIs" class="headerlink" title="单独文档的APIs"></a>单独文档的APIs</h2><h3 id="Index-API"><a href="#Index-API" class="headerlink" title="Index API"></a>Index API</h3><h4 id="生成Json"><a href="#生成Json" class="headerlink" title="生成Json"></a>生成Json</h4><ul>
<li>手动</li>
<li>使用<code>Map</code></li>
<li>使用第三方库如Jackson</li>
<li>使用內建的jsonBuilder()</li>
</ul>
<h4 id="建立索引文档"><a href="#建立索引文档" class="headerlink" title="建立索引文档"></a>建立索引文档</h4><p>下面的例子是建立一个索引为twitter,类型为tweet,id为1的文档,<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import static org.elasticsearch.common.xcontent.XContentFactory.*;</span><br><span class="line"> </span><br><span class="line">IndexResponse response = client.prepareIndex(&quot;twitter&quot;, &quot;tweet&quot;, &quot;1&quot;)</span><br><span class="line">        .setSource(jsonBuilder()</span><br><span class="line">                    .startObject()</span><br><span class="line">                        .field(&quot;user&quot;, &quot;kimchy&quot;)</span><br><span class="line">                        .field(&quot;postDate&quot;, new Date())</span><br><span class="line">                        .field(&quot;message&quot;, &quot;trying out Elasticsearch&quot;)</span><br><span class="line">                    .endObject()</span><br><span class="line">                  )</span><br><span class="line">        .get();</span><br></pre></td></tr></table></figure></p>
<p>或者通过另一种建立json的方式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">String json = &quot;&#123;&quot; +</span><br><span class="line">        &quot;\&quot;user\&quot;:\&quot;kimchy\&quot;,&quot; +</span><br><span class="line">        &quot;\&quot;postDate\&quot;:\&quot;2013-01-30\&quot;,&quot; +</span><br><span class="line">        &quot;\&quot;message\&quot;:\&quot;trying out Elasticsearch\&quot;&quot; +</span><br><span class="line">    &quot;&#125;&quot;;</span><br><span class="line"> </span><br><span class="line">IndexResponse response = client.prepareIndex(&quot;twitter&quot;, &quot;tweet&quot;)</span><br><span class="line">        .setSource(json)</span><br><span class="line">        .get();</span><br></pre></td></tr></table></figure></p>
<p>之后你可以通过调用上面的<code>response</code>来查看建立的结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// Index name</span><br><span class="line">String _index = response.getIndex();</span><br><span class="line">// Type name</span><br><span class="line">String _type = response.getType();</span><br><span class="line">// Document ID (generated or not)</span><br><span class="line">String _id = response.getId();</span><br><span class="line">// Version (if it&apos;s the first time you index this document, you will get: 1)</span><br><span class="line">long _version = response.getVersion();</span><br><span class="line">// isCreated() is true if the document is a new one, false if it has been updated</span><br><span class="line">boolean created = response.isCreated();</span><br></pre></td></tr></table></figure></p>
<h3 id="GetAPI"><a href="#GetAPI" class="headerlink" title="GetAPI"></a>GetAPI</h3><p>下面使用client调用 index是 twitter type是tweet id为1的文档<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GetResponse response = client.prepareGet(&quot;twitter&quot;, &quot;tweet&quot;, &quot;1&quot;).get();</span><br></pre></td></tr></table></figure></p>
<p>更多的getapi则需要参考<a href="http://www.elastic.co/guide/en/elasticsearch/reference/5.0/docs-get.html" target="_blank" rel="noopener">get docs</a></p>
<p>其它的delete update multiget  bulkapi都需要查看es的相应rest调用文档</p>
<h3 id="BulkAPI"><a href="#BulkAPI" class="headerlink" title="BulkAPI"></a>BulkAPI</h3><p>bulk API 允许你通过一个请求来检索或者删除多个文档,增加吞吐量,下面是一个应用:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">import static org.elasticsearch.common.xcontent.XContentFactory.*;</span><br><span class="line"> </span><br><span class="line">BulkRequestBuilder bulkRequest = client.prepareBulk();</span><br><span class="line"> </span><br><span class="line">// either use client#prepare, or use Requests# to directly build index/delete requests</span><br><span class="line">bulkRequest.add(client.prepareIndex(&quot;twitter&quot;, &quot;tweet&quot;, &quot;1&quot;)</span><br><span class="line">        .setSource(jsonBuilder()</span><br><span class="line">                    .startObject()</span><br><span class="line">                        .field(&quot;user&quot;, &quot;kimchy&quot;)</span><br><span class="line">                        .field(&quot;postDate&quot;, new Date())</span><br><span class="line">                        .field(&quot;message&quot;, &quot;trying out Elasticsearch&quot;)</span><br><span class="line">                    .endObject()</span><br><span class="line">                  )</span><br><span class="line">        );</span><br><span class="line"> </span><br><span class="line">bulkRequest.add(client.prepareIndex(&quot;twitter&quot;, &quot;tweet&quot;, &quot;2&quot;)</span><br><span class="line">        .setSource(jsonBuilder()</span><br><span class="line">                    .startObject()</span><br><span class="line">                        .field(&quot;user&quot;, &quot;kimchy&quot;)</span><br><span class="line">                        .field(&quot;postDate&quot;, new Date())</span><br><span class="line">                        .field(&quot;message&quot;, &quot;another post&quot;)</span><br><span class="line">                    .endObject()</span><br><span class="line">                  )</span><br><span class="line">        );</span><br><span class="line"> </span><br><span class="line">BulkResponse bulkResponse = bulkRequest.get();</span><br><span class="line">if (bulkResponse.hasFailures()) &#123;</span><br><span class="line">    // process failures by iterating through each bulk response item</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="使用Using-Bulk-Processor"><a href="#使用Using-Bulk-Processor" class="headerlink" title="使用Using Bulk Processor"></a>使用Using Bulk Processor</h3><p><code>BulkProcessor</code>类提供了一个简单的接口可以通过请求的数量或者给定的时间来自动的进行flush操作.<br>使用这个类,首先要创建一个BulkProcessor实例:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import org.elasticsearch.action.bulk.BackoffPolicy;</span><br><span class="line">import org.elasticsearch.action.bulk.BulkProcessor;</span><br><span class="line">import org.elasticsearch.common.unit.ByteSizeUnit;</span><br><span class="line">import org.elasticsearch.common.unit.ByteSizeValue;</span><br><span class="line">import org.elasticsearch.common.unit.TimeValue;</span><br><span class="line"> </span><br><span class="line">BulkProcessor bulkProcessor = BulkProcessor.builder(</span><br><span class="line">        client, </span><br><span class="line">        new BulkProcessor.Listener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void beforeBulk(long executionId,</span><br><span class="line">                                   BulkRequest request) &#123; ... &#125;</span><br><span class="line"> </span><br><span class="line">            @Override</span><br><span class="line">            public void afterBulk(long executionId,</span><br><span class="line">                                  BulkRequest request,</span><br><span class="line">                                  BulkResponse response) &#123; ... &#125;</span><br><span class="line"> </span><br><span class="line">            @Override</span><br><span class="line">            public void afterBulk(long executionId,</span><br><span class="line">                                  BulkRequest request,</span><br><span class="line">                                  Throwable failure) &#123; ... &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .setBulkActions(10000)</span><br><span class="line">        .setBulkSize(new ByteSizeValue(5, ByteSizeUnit.MB))</span><br><span class="line">        .setFlushInterval(TimeValue.timeValueSeconds(5))</span><br><span class="line">        .setConcurrentRequests(1)</span><br><span class="line">        .setBackoffPolicy(</span><br><span class="line">            BackoffPolicy.exponentialBackoff(TimeValue.timeValueMillis(100), 3))</span><br><span class="line">        .build();</span><br></pre></td></tr></table></figure></p>
<p>其中的<code>setConcurrentRequests(1)</code>指同时允许多少个并发,0的话意味着不允许,1则表示允许一个并发请求.<br><code>setBackoffPolicy</code>则可以允许用户自定义当一个或者多个bulk请求失败后,该执行如何操作,而这个失败是要求基于<code>EsRejectedExecutionException</code>,也就是说集群内的计算资源不够导致的请求失败,如果不设定的话使用<code>BackoffPolicy.noBackoff()</code><br>当所有的需要执行的操作加载到bulk中之后,可使用两种方式来关闭这个bulk<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bulkProcessor.awaitClose(10, TimeUnit.MINUTES);</span><br><span class="line">or</span><br><span class="line">bulkProcessor.close();</span><br></pre></td></tr></table></figure></p>
<p>这两个操作都会flush所有的剩余bulk操作,前者会等待一段时间,如果在这段时间 flush成功,则返回<code>true</code> 否则返回<code>false</code>,<br>后者则会直接退出,不在等待所有的bulk执行操作完成</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.elastic.co/guide/en/elasticsearch/client/java-api/current/" target="_blank" rel="noopener">ElasticSearch Java API</a></p>
<hr>
<p>版权声明:本文由littleji.com创作并发表,转载请注明作者及出处,欢迎关注公众号:littleji_com<br><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">本文遵守CC BY0SA 4.0</a><br>if you have any questions, please leave a message behind or give an <a href="https://github.com/littleji/littleji.github.io/issues" target="_blank" rel="noopener">issue</a></p>
<p>本文链接为：<a href="http://littleji.com/2016/12/01/20161201UseJavaApiForElasticSearch2/">http://littleji.com/2016/12/01/20161201UseJavaApiForElasticSearch2/</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-11-30T06:27:20.000Z"><a href="/2016/11/30/20161130UseJavaApiForElasticSearch1/">2016-11-30</a></time>
      
      
  
    <h1 class="title"><a href="/2016/11/30/20161130UseJavaApiForElasticSearch1/">使用ElasticSearch的JavaAPI 1(UseJavaApiForElasticSearch 1)</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="配置-configuration"><a href="#配置-configuration" class="headerlink" title="配置(configuration)"></a>配置(configuration)</h2><h3 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h3><p>要使用相应的API,必须引入所需要的jar包,这里使用的ElasticSearch5.0版本相应的Maven配置如下所示:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;transport&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.0.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;log4j-api&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.6.2&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.6.2&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="日志-Logger"><a href="#日志-Logger" class="headerlink" title="日志(Logger)"></a>日志(Logger)</h3><p>之后配置日志,这里使用的是log4j2,在<code>src/main/resources</code>下添加名为<code>log4f2.properties</code>的文件,并在其中添加如下的内容:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">appender.console.type = Console</span><br><span class="line">appender.console.name = console</span><br><span class="line">appender.console.layout.type = PatternLayout</span><br><span class="line"> </span><br><span class="line">rootLogger.level = info</span><br><span class="line">rootLogger.appenderRef.console.ref = console</span><br></pre></td></tr></table></figure></p>
<h3 id="整体打包-Embedding-jar-with-dependencies"><a href="#整体打包-Embedding-jar-with-dependencies" class="headerlink" title="整体打包(Embedding jar with dependencies)"></a>整体打包(Embedding jar with dependencies)</h3><p>将所使用的jar依赖包和你的应用同时打包为一个jar文件,此时不应该使用<code>maven-assembly-plugin</code>, 因为没有Lucene的jar包,导致该插件无法解析<code>META-INF/service</code>的结构,相应的你可以使用<code>maven-shade-plugin</code>插件,配置如下所示<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugin&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.4.1&lt;/version&gt;</span><br><span class="line">    &lt;executions&gt;</span><br><span class="line">        &lt;execution&gt;</span><br><span class="line">            &lt;phase&gt;package&lt;/phase&gt;</span><br><span class="line">            &lt;goals&gt;&lt;goal&gt;shade&lt;/goal&gt;&lt;/goals&gt;</span><br><span class="line">            &lt;configuration&gt;</span><br><span class="line">                &lt;transformers&gt;</span><br><span class="line">                    &lt;transformer implementation=&quot;org.apache.maven.plugins.shade.resource.ServicesResourceTransformer&quot;/&gt;</span><br><span class="line">                &lt;/transformers&gt;</span><br><span class="line">            &lt;/configuration&gt;</span><br><span class="line">        &lt;/execution&gt;</span><br><span class="line">    &lt;/executions&gt;</span><br><span class="line">&lt;/plugin&gt;</span><br></pre></td></tr></table></figure></p>
<p>如果有main.class 可加入下面的配置:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;transformer implementation=&quot;org.apache.maven.plugins.shade.resource.ManifestResourceTransformer&quot;&gt;</span><br><span class="line">    &lt;mainClass&gt;org.elasticsearch.demo.Generate&lt;/mainClass&gt;</span><br><span class="line">&lt;/transformer&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="使用客户端-Client"><a href="#使用客户端-Client" class="headerlink" title="使用客户端(Client)"></a>使用客户端(Client)</h3><p>客户端可以做以下几件事情:</p>
<ol>
<li>在已有的集群之上进行,索引,插入,删除,搜索等操作</li>
<li>在已有的集群上运行管理员的任务</li>
</ol>
<ul>
<li>注意: 客户端的主版本号必须同集群节点的版本号相一致<br>一般通过<code>TransportClient</code> 来连接ES集群</li>
</ul>
<h3 id="TransportClient"><a href="#TransportClient" class="headerlink" title="TransportClient"></a>TransportClient</h3><p>当你使用TansportClient来连接一个ES集群的时候,你并不参与到这个集群中,而是获得这个集群的一个或多个地址,并在实际执行操作的时候,依次的操作它们,尽管大多数的操作都可能是两段式的(It does not join the cluster, but simply gets one or more initial transport addresses and communicates with them in round robin fashion on each action(though most actions will probably be “two hop” operations).)<br>下面是如何开始和结束一个TransportClient<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// on startup</span><br><span class="line"> </span><br><span class="line">TransportClient client = new PreBuiltTransportClient(Settings.EMPTY)</span><br><span class="line">        .addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(&quot;host1&quot;), 9300))</span><br><span class="line">        .addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(&quot;host2&quot;), 9300));</span><br><span class="line"> </span><br><span class="line">// on shutdown</span><br><span class="line"> </span><br><span class="line">client.close();</span><br></pre></td></tr></table></figure></p>
<p>其中得Setting,按照下面所示进行设置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Settings settings = Settings.builder()</span><br><span class="line">        .put(&quot;cluster.name&quot;, &quot;myClusterName&quot;).build();</span><br><span class="line">TransportClient client = new PreBuiltTransportClient(settings);</span><br><span class="line">//Add transport addresses and do something with the client...</span><br></pre></td></tr></table></figure></p>
<p>TransportClient 自身有一个集群发现的功能,其能够动态的添加host和移除之前已有的.<br>一旦发现功能启用,transport client就将根据其配置的节点列表进行连接,而节点列表的配置则是通过<code>addTransportAddress</code>来配置的.之后,客户端将调用集群内部的状态API,来发现可用的数据节点.内部客户端的节点列表将替换为只有数据节点,并且这份列表默认每过5秒,刷新一次<br>如果需要开启发现功能,设置<code>client.trasport.sniff</code>为true</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.elastic.co/guide/en/elasticsearch/client/java-api/current/" target="_blank" rel="noopener">ElasticSearch Java API</a></p>
<hr>
<p>版权声明:本文由littleji.com创作并发表,转载请注明作者及出处,欢迎关注公众号:littleji_com<br><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">本文遵守CC BY0SA 4.0</a><br>if you have any questions, please leave a message behind or give an <a href="https://github.com/littleji/littleji.github.io/issues" target="_blank" rel="noopener">issue</a></p>
<p>本文链接为：<a href="http://littleji.com/2016/11/30/20161130UseJavaApiForElasticSearch1/">http://littleji.com/2016/11/30/20161130UseJavaApiForElasticSearch1/</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






<nav id="pagination">
  
    <a href="/" class="alignleft prev">上一页</a>
  
  
    <a href="/page/3/" class="alignright next">下一页</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//baidu.com" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:littleji.com">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/2019-02/">2019-02</a><small>2</small></li>
  
    <li><a href="/categories/2018-12/">2018-12</a><small>3</small></li>
  
    <li><a href="/categories/2018-11/">2018-11</a><small>1</small></li>
  
    <li><a href="/categories/2018-10/">2018-10</a><small>3</small></li>
  
    <li><a href="/categories/2018-09/">2018-09</a><small>2</small></li>
  
    <li><a href="/categories/2018-02/">2018-02</a><small>1</small></li>
  
    <li><a href="/categories/2018-01/">2018-01</a><small>2</small></li>
  
    <li><a href="/categories/2017-05/">2017-05</a><small>1</small></li>
  
    <li><a href="/categories/2016-12/">2016-12</a><small>4</small></li>
  
    <li><a href="/categories/2016-11/">2016-11</a><small>4</small></li>
  
    <li><a href="/categories/2016-05/">2016-05</a><small>2</small></li>
  
    <li><a href="/categories/2016-04/">2016-04</a><small>1</small></li>
  
  </ul>
</div>



  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/Algorithm/">Algorithm</a><small>1</small></li>
  
    <li><a href="/tags/BookList/">BookList</a><small>1</small></li>
  
    <li><a href="/tags/DataMining/">DataMining</a><small>1</small></li>
  
    <li><a href="/tags/DataStructure/">DataStructure</a><small>1</small></li>
  
    <li><a href="/tags/DistributedComputation/">DistributedComputation</a><small>3</small></li>
  
    <li><a href="/tags/ELK/">ELK</a><small>3</small></li>
  
    <li><a href="/tags/ElasticSearch/">ElasticSearch</a><small>2</small></li>
  
    <li><a href="/tags/Error/">Error</a><small>1</small></li>
  
    <li><a href="/tags/Git/">Git</a><small>1</small></li>
  
    <li><a href="/tags/Golang/">Golang</a><small>1</small></li>
  
    <li><a href="/tags/Graph/">Graph</a><small>1</small></li>
  
    <li><a href="/tags/Java/">Java</a><small>2</small></li>
  
    <li><a href="/tags/Linux/">Linux</a><small>2</small></li>
  
    <li><a href="/tags/Logstash/">Logstash</a><small>2</small></li>
  
    <li><a href="/tags/MachineLearning/">MachineLearning</a><small>5</small></li>
  
    <li><a href="/tags/MySQL/">MySQL</a><small>1</small></li>
  
    <li><a href="/tags/Mybatis/">Mybatis</a><small>1</small></li>
  
    <li><a href="/tags/NLP/">NLP</a><small>3</small></li>
  
    <li><a href="/tags/Navicat/">Navicat</a><small>1</small></li>
  
    <li><a href="/tags/ORM/">ORM</a><small>1</small></li>
  
    <li><a href="/tags/Programmer/">Programmer</a><small>1</small></li>
  
    <li><a href="/tags/Programming/">Programming</a><small>5</small></li>
  
    <li><a href="/tags/Rpc/">Rpc</a><small>2</small></li>
  
    <li><a href="/tags/Security/">Security</a><small>1</small></li>
  
    <li><a href="/tags/SiteManagement/">SiteManagement</a><small>1</small></li>
  
    <li><a href="/tags/SoftwareEngineering/">SoftwareEngineering</a><small>2</small></li>
  
    <li><a href="/tags/Translate/">Translate</a><small>2</small></li>
  
    <li><a href="/tags/jsonrpc4j/">jsonrpc4j</a><small>2</small></li>
  
    <li><a href="/tags/life/">life</a><small>1</small></li>
  
    <li><a href="/tags/信息安全/">信息安全</a><small>1</small></li>
  
    <li><a href="/tags/区块链/">区块链</a><small>1</small></li>
  
    <li><a href="/tags/图/">图</a><small>1</small></li>
  
    <li><a href="/tags/思考/">思考</a><small>1</small></li>
  
    <li><a href="/tags/数据挖掘/">数据挖掘</a><small>1</small></li>
  
    <li><a href="/tags/数据结构/">数据结构</a><small>1</small></li>
  
    <li><a href="/tags/框架/">框架</a><small>1</small></li>
  
    <li><a href="/tags/算法/">算法</a><small>1</small></li>
  
    <li><a href="/tags/自然语言处理/">自然语言处理</a><small>1</small></li>
  
    <li><a href="/tags/计算机语言/">计算机语言</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2019/02/19/20190219HandoverMemoList/">软件项目交接清单</a>
      </li>
    
      <li>
        <a href="/2019/02/12/20190212OptimizeTheDevelopmentProcess - 副本/">用gitlab来优化我们的软件开发流程</a>
      </li>
    
      <li>
        <a href="/2018/12/25/20181225MLReview3/">七天算法梳理之决策树</a>
      </li>
    
      <li>
        <a href="/2018/12/22/20181222MLReview2/">七天算法梳理之逻辑回归</a>
      </li>
    
      <li>
        <a href="/2018/12/18/20181218MLReview1/">七天算法梳理之线性回归</a>
      </li>
    
  </ul>
</div>


  
<div class="widget links">
  <h3 class="title">友链</h3>
  <ul class="entry">
    
      <li><a href="http://www.xiaobaidonghui.cn">小白</a></li>
    
  </ul>
</div>


</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2019 littleji
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'littleji';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
